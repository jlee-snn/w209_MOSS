<!--
=========================================================
 Paper Dashboard 2 - v2.0.0
=========================================================

 Product Page: https://www.creative-tim.com/product/paper-dashboard-2
 Copyright 2019 Creative Tim (https://www.creative-tim.com)
 Licensed under MIT (https://github.com/creativetimofficial/paper-dashboard/blob/master/LICENSE)

 Coded by Creative Tim

=========================================================

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. -->



<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Model Output Score Scrutinizer
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="/static/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/static/css/paper-dashboard.css?v=2.0.0" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="/static/demo/demo.css" rel="stylesheet" />

  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">
  <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
  <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
  <script>
  window.onload = function() {

  var dataPoints = [];

  var chart = new CanvasJS.Chart("chartContainer", {
  	animationEnabled: true,
  	theme: "light2",
  	title: {
  		text: "Daily Sales Data"
  	},
  	axisY: {
  		title: "Units",
  		titleFontSize: 24
  	},
  	data: [{
  		type: "column",
  		yValueFormatString: "#,### Units",
  		dataPoints: dataPoints
  	}]
  });

  function addData(data) {
  	for (var i = 0; i < data.length; i++) {
  		dataPoints.push({
  			x: new Date(data[i].date),
  			y: data[i].units
  		});
  	}
  	chart.render();

  }

  $.getJSON("https://canvasjs.com/data/gallery/javascript/daily-sales-data.json", addData);

  }
  </script>

  <script type="text/javascript">
    $(document).ready(function() {
    $("#btnFetch").click(function() {
      // disable button
      $(this).prop("disabled", true);
      // add spinner to button
      $(this).html(
        `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...`
      );
    });
});
 </script>

</head>

<body class="">
  <div class="wrapper ">
    <div class="sidebar" data-color="white" data-active-color="danger">
      <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red | yellow"
    -->
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="active ">
            <a href="./dashboard.html">
              <i class="nc-icon nc-bank"></i>
              <p>Dashboard</p>
            </a>
          </li>
          <li>
            <a href="./tables.html">
              <i class="nc-icon nc-tile-56"></i>
              <p>About</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <div class="navbar-toggle">
              <button type="button" class="navbar-toggler">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
              </button>
            </div>
            <a class="navbar-brand" href="#pablo">Model Output Score Scrutinizer</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
          </button>
        </div>
      </nav>
      <!-- End Navbar -->
      <!-- <div class="panel-header panel-header-lg">

  <canvas id="bigDashboardChart"></canvas>


</div> -->
      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <div class="card ">
              <div class="card-header ">
                <h5 class="card-title">Simplifying Model interpretability for Data Scientists</h5>
              </div>
              <div class="card-body ">
                <p>Model interpretability is a common challenge that many data scientists face, especially with black box models such as neural networks and decision trees. To help address this, the MOSS dashboard provides visualizations from the data results that are provided by LIME (Local Interpretable Model-agnostic Explanations), a novel explanation technique that explains the prediction of any classifier in an interpretable and faithful manner by learning a interpretable model locally around the prediction.</p>

                <p>To do this, our proof-of-concept dashboard tool ingests a binary classification model for text classification on whether the email is about Christianity or Atheism and relevant test data and leveraging the LIME python library, displays its results in a human-readable manner. Below are instructions to do this:</p>

                <li>Change the name of target variable to “target”</li>
                <li>Select and load in a model pickle file and csv test data</li>
                <li>Please upload vectorizer if you are implementing a language model, for example please refer to ./upload_example with test artifacts.</li>
                <li>Interpret dashboard results</li>

                <p></p>
                <p>The dashboard is divided into 3 sections:</p>

                <p>First section is the info boxes that convey general information about the model. </p>
                <p>Second section has the uploading artifacts and a dynamic display of the variable importance (top 30). </p>
                <p>Finally, at the bottom is a table of all test data text records with index and their model output probabilities of being about Christianity or Atheism. By selecting a record in this table, the text is highlighted and generated above the table.</p>
              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">



          <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="card card-stats">
              <div class="card-body ">
                <div class="row">
                  <div class="col-5 col-md-4">
                    <div class="icon-big text-center icon-warning">
                      <i class="nc-icon nc-globe text-warning"></i>
                    </div>
                  </div>
                  <div class="col-7 col-md-8">
                    <div class="numbers">
                      <p class="card-category">Model Accuracy</p>
                      <p class="card-title">
                        <p>
                    <p><font size="3">{{ accuracy }}</font></p>
                        </p>
                        </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats">
                  <i class="fa fa-refresh"></i> ...
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="card card-stats">
              <div class="card-body ">
                <div class="row">
                  <div class="col-5 col-md-4">
                    <div class="icon-big text-center icon-warning">
                      <i class="nc-icon nc-money-coins text-success"></i>
                    </div>
                  </div>
                  <div class="col-7 col-md-8">
                    <div class="numbers">
                      <p class="card-category">Model Precision</p>
                      <p class="card-title">
                        <p><font size="3">{{ precision }}</font></p>
                        </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats">
                  <i class="fa fa-calendar-o"></i>...
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="card card-stats">
              <div class="card-body ">
                <div class="row">
                  <div class="col-5 col-md-4">
                    <div class="icon-big text-center icon-warning">
                      <i class="nc-icon nc-vector text-danger"></i>
                    </div>
                  </div>
                  <div class="col-7 col-md-8">
                    <div class="numbers">
                      <p class="card-category">Model Recall</p>
                      <p class="card-title">
                            <p><font size="3">{{ recall }}</font></p>
                        </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats">
                  <i class="fa fa-clock-o"></i> ...
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="card card-stats">
              <div class="card-body ">
                <div class="row">
                  <div class="col-5 col-md-4">
                    <div class="icon-big text-center icon-warning">
                      <i class="nc-icon nc-favourite-28 text-primary"></i>
                    </div>
                  </div>
                  <div class="col-7 col-md-8">
                    <div class="numbers">
                      <p class="card-category">Type of Model</p>
                      <p class="card-title">
                        <p>
                          <p><font size="2">{{ text }}</font></p>
                      </p>

                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats">
                  <i class="fa fa-refresh"></i> ...
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="card ">
              <div class="card-header ">
                <h5 class="card-title">Upload Artifacts</h5>
                <p class="card-category">Load model and test data</p>
              </div>
              <div class="card-body ">
        				<p>Select file(s) to upload</p>
        				<p>
        					{% with messages = get_flashed_messages() %}
        						{% if messages %}
        						<ul class=flashes>
        						{% for message in messages %}
        							<li>{{ message }}</li>
        						{% endfor %}
        						</ul>
        						{% endif %}
        					{% endwith %}
        				</p>


               <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">


                <form method="post" action="/" enctype="multipart/form-data">
        						<dl>
        						<p>
        							<input type="file" name="files[]" multiple="true" autocomplete="off" required>
        						</p>
        						</dl>
        						<p>

        						<button type="submit" id="btnFetch" class="btn btn-primary mb-2">Submit</button>
        					</p>
                  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
                  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
        				</form>

                <canvas id="formUpload"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="card card-chart">
              <div class="card-header">
                <h5 class="card-title">Variable Importance</h5>
                <p class="card-category">Top 20 Features from Random Forest Classifier</p>
              </div>
              <div class="card-body">
                <div class="container-fluid">

                  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
                  <div class="chart" id="bargraph">

                      <script>
                          var graphs = {{plot | safe}};
                          Plotly.plot('bargraph',graphs,{});
                      </script>

                  </div>






               </div>
              </div>
              <div class="card-footer">
                <div class="chart-legend">
                </div>
                <hr/>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">


            <div class="card ">
              <div class="card-header ">
                <h5 class="card-title">Data Viewer</h5>
                <p class="card-category">Table of loaded test set</p>
              </div>
              <div class="card-body">
                <div id="events">
        					Row selected count - new information added at the top
        				</div>
                <div>
                    {% block tables %}
                    {{tables|safe}}
                    {% endblock %}
                </div>
                </div>
                <script src="https://code.jquery.com/jquery-3.3.1.js" type="text/javascript"></script>
                <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" type="text/javascript"></script>
                <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js" type="text/javascript"></script>
                <script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js" type="text/javascript"></script>
                <script type="text/javascript">
                  $(document).ready(function() {
                    var events = $('#events');
                    var table = $('#example').DataTable( {
                        dom: 'Bfrtip',
                        select: true,
                        buttons: [
                            {
                                text: 'Get selected data',
                                action: function () {
                                  function markWords(text, searchWordArray) {
                                    return text.split(" ").map(word => {
                                      let rawWord = word.toLowerCase().replace(/\W/g, ""); //lowercase and remove punctuation (except underscore...)
                                      if (searchWordArray.includes(rawWord)) return "<mark>" + word + "</mark>";
                                      return word;
                                    }).join(" ");
                                  };
                                    var rows = table.rows({ selected: true }).data()[0][1];
                                    var doc = table.rows({ selected: true }).data()[0][0];

                                    var l1 = table.rows({ selected: true }).data()[0][6];
                                    var l2 = table.rows({ selected: true }).data()[0][7];
                                    var l3 = table.rows({ selected: true }).data()[0][8];
                                    var l4 = table.rows({ selected: true }).data()[0][9];
                                    var l5 = table.rows({ selected: true }).data()[0][10];
                                    events.empty()
                                    events.append('<div> <p> <b>DOC ID: </b>'+doc+'</p></div>' );
                                    events.append('<div> <p> <b>Lime Feature 1: </b>'+l1+'</p></div>' );
                                    events.append('<div> <p> <b>Lime Feature 2: </b>'+l2+'</p></div>' );
                                    events.append('<div> <p> <b>Lime Feature 3: </b>'+l3+'</p></div>' );
                                    events.append('<div> <p> <b>Lime Feature 4: </b>'+l4+'</p></div>' );
                                    events.append('<div> <p> <b>Lime Feature 5: </b>'+l5+'</p></div>' );

                                    events.append('<div> <p> </p> </div>' );

                                    events.append('<div> <b>Raw Text: </b></div>' );
                                    events.append('<div>'+markWords(rows, ["university", "Christian", "christianity","homosexuality","extremism","Rudolf",
                                    "avoid",
                                    "lexicons",
                                    "religion",
                                    "suffers",
                                    "evolution",
                                    "homosexual"]

                                      )+'</div>' );
                                    var obj = { docID: doc};
                                    var myJSON = JSON.stringify(obj);
                                    $.ajax({
                                      type : "POST",
                                      url : '/get_doc_id',
                                      data: myJSON,
                                      contentType: 'application/json',
                                      dataType: "json",
                                      success: function(result) {
                                          console.log(result);
                                      }
                                  });
                                }
                            }
                        ]
                    } );

                } );
                </script>





              </div>
              <div class="card-footer ">
                <hr>
                <div class="stats">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer class="footer footer-black  footer-white ">
        <div class="container-fluid">
          <div class="row">
            <nav class="footer-nav">
              <ul>
                <li>
                  <a href="" target="_blank">Model Output Score Scrutinizer</a>
                </li>
                <li>
                  <a href="" target="_blank">Github</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </footer>
    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="../assets/js/core/jquery.min.js"></script>
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!--  Google Maps Plugin    -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
  <!-- Chart JS -->
  <script src="../assets/js/plugins/chartjs.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/paper-dashboard.min.js?v=2.0.0" type="text/javascript"></script>
  <!-- Paper Dashboard DEMO methods, don't include it in your project! -->
  <script src="../assets/demo/demo.js"></script>
  <script>
    $(document).ready(function() {
      // Javascript method's body can be found in assets/assets-for-demo/js/demo.js
      demo.initChartsPages();
    });
  </script>
</body>

</html>
